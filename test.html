<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <script src="sinon.js"></script>
        <script src="jasmine.js"></script>
        <script src="jasmine-html.js"></script>
        <script src="jasmine-boot.js"></script>
        <link rel="stylesheet" href="jasmine.css">
        <script src="Promise.js"></script>
        <script>
            log = console.log.bind(console,'logged');
            describe('Promise =>', function () {
                var p = null;
                var testValue = 'some nice value';
                var resolveHandler = null;
                var rejectHandler = null;
                var spy = null;

                beforeAll(function () {

                });
                it('created',function() {
                    p = new _Promise(function (res, rej) {
                        resolveHandler = res;
                    });
//                    expect(p).toExist();
                });
                describe('register "then" ',function () {
                    beforeAll(function () {
                        spy = sinon.spy();
                    });
                    it('shoud not invoked before resoleve',function () {
                        p.then(spy);
                        expect(spy.notCalled).toBeTruthy();

                    })
                    it('should invoke after resolve',function () {
                        resolveHandler(testValue);
                        expect(spy.calledOnce).toBeTruthy();
                        expect(spy.calledWith(testValue)).toBeTruthy();
                    })

                });
                describe('register "then" again =>',function () {
                    beforeAll(function () {
                        spy = sinon.spy();
                    });
                    it('shoud invoked imidiatly',function () {
                        p.then(spy);
                        expect(spy.calledOnce).toBeTruthy();
                        expect(spy.calledWith(testValue)).toBeTruthy();
                    });
                    it('should not invoke again after another resolve',function () {
                        resolveHandler(testValue);
                        expect(spy.calledOnce).toBeTruthy();

                    })

                });




            })
        </script>


    </head>
<body>

</body>
</html>